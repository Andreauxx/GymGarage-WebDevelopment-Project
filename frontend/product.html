<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shop | GymGarage</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Michroma&display=swap"
      rel="stylesheet"
    />
    <!-- Removed Lato font reference -->
    <link rel="stylesheet" href="product.css" />
    <script src="frontend/frontend_display_logics/products.js" defer></script>
  </head>
  <body>
    <!-- Main Navigation -->
    <nav class="main-nav">
      <div class="logo">
        <img src="Images/FinalLogo.png" alt="GymGarage Logo" />
        <span class="logofont">GYMGARAGE</span>
      </div>
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="shop">Shop</a></li>
        <li><a href="plans">Plans</a></li>
        <li><a href="coaches">Coaches</a></li>
        <li><a href="about">About Us</a></li>
        <li>
          <a href="cart">
            <i class="fas fa-shopping-cart"></i>
            Cart <span class="cart-counter">0</span>
          </a>
        </li>
        <li>
          <a href="login"> <i class="fas fa-user-plus"></i> Login/Sign Up </a>
        </li>
      </ul>
    </nav>

    <section class="breadcrumb">
      <p>
        <a href="/">Home</a> / <a href="/equipment.html">Gym Equipment</a> /
        Product Details
      </p>
    </section>

    <section id="product-details" class="product-details">
      <!-- Product details will be dynamically inserted here -->
    </section>

    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get("id");
      console.log('Product ID:', productId);

      async function fetchProductDetails() {
        try {
          const response = await fetch(`http://localhost:3000/api/products/${productId}`);
          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

          const product = await response.json();
          const thumbnails = product.product_images 
            ? product.product_images.map(img => `<img src="${img.image_url}" alt="Thumbnail">`).join('')
            : '';

          document.getElementById("product-details").innerHTML = `
            <div class="product-gallery">
              <img src="${product.image_url}" alt="${product.name}" class="main-img" />
              <div class="thumbnail-images">${thumbnails}</div>
            </div>

            <div class="product-info">
              <h1>${product.name}</h1>
              <div class="price">
                <span class="original-price">₱${product.original_price}</span>
                ${product.discounted_price ? `<span class="discounted-price">₱${product.discounted_price}</span>` : ''}
              </div>
              <div class="stock-status">
                <p>Stock Status: <span>${product.stock > 0 ? 'In Stock' : 'Sold Out'}</span></p>
              </div>
              <div class="description">
                <p>${product.description || 'No description available.'}</p>
              </div>
              <div class="action-buttons">
                <button class="add-to-cart" data-product-id="${product.id}">Add to Cart</button>
                <button class="buy-now-btn">Buy it now</button>
              </div>
            </div>
          `;
        } catch (error) {
          console.error("Error displaying product details:", error);
          document.getElementById("product-details").innerHTML = `<p>Failed to load product details. Please try again later.</p>`;
        }
      }

      document.addEventListener("DOMContentLoaded", fetchProductDetails);
    </script>
  </body>
</html>
